---
title: "Factors of Alcoholism Prevalance Rates"
author: "Krista Shuckerow"
date: "March 24, 2018"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

We want to studey factors that affect alcoholism prevalence across the world. The World Health Organization has a variety of factors such as gender, region, break down of alcohol sales, the proportion of men and women who abstain from alcohol per country and region, which we can use in our analysis. The response variable is the prevalence of alcoholism in a country. We will collect data from the Global Health Observatory data repository which is maintained by the World Health Organization. 

A person is classified as suffering from alcoholism if they have a disorder attributable to the consumption of alcohol. This includes binge drinking, drinking to get drunk, and heavy excessive drinking. Prevalence is defined as the percent of adults (15+ years of age) with a diagnosis of alcoholism during a given calendar year. All data comes from the year 2010.

The income index comes from the Human Development Index released by the United Nations in their human development reports.  The income index is defined as GNI per capita (2005 PPP International \$, using natural logarithm) expressed as an index using a minimum value of \$100 and a maximum value $75,000.


# Analysis 

In this paper we will perform tests at a 95% confidence level unless otherwise stated. 

### Gender Differences

We will begin our analysis by determining if there is a significant difference in the proportion of men and women who suffer from alcoholism prevalence across the world. 

#### Raw Data

```{r echo = FALSE}
alcoholism <- read.csv("data.csv", header = F, row.names = 1)
colnames(alcoholism) <- as.character(unlist(alcoholism[2,]))
alcoholism <- alcoholism[c(-1,-2),]
alcoholism$Male <- gsub("\\[.{1,}", "", alcoholism$Male)
alcoholism$Female <- gsub("\\[.{1,}", "", alcoholism$Female)
alcoholism$`Both sexes` <- gsub("\\[.{1,}", "",alcoholism$`Both sexes`)
alcoholism$Male <- as.numeric(alcoholism$Male)
alcoholism$Female <- as.numeric(alcoholism$Female)
alcoholism$`Both sexes` <- as.numeric(alcoholism$`Both sexes`)

head(alcoholism)
```

Looking at the first few data points we see that the data is paired by country. Let's look at the distribution of the data. 


```{r echo=TRUE}
summary(alcoholism)
```
```{r echo = FALSE}
boxplot.default(alcoholism[c(-1, -2)], main = "Distribution of Proportion Suffering From Alcoholism", horizontal = T)

```

Each individual distribution appears skewed to the right. Both Male and Female distributions have various outliers. Looking at the summary of the data both the median and mean of the male distribution are higher than that of then women. 

#### Testing difference

We want to test the difference between the prevalence rate amoung men and women. We will use a paired t-test Our null hypothesis is there is no difference in the prevalence rates. Our alternative hypothesis is that male prevalence rates are higher than female prevalence rates. We will test at the 95% significance level. 

$$H_0: p_m - p_f \leq  0$$
$$H_a: p_m - p_f > 0 $$ 

```{r echo= TRUE}
difference <- alcoholism$Male - alcoholism$Female
summary(difference)

boxplot(difference, horizontal = TRUE, main = "Distribution in Difference of Alcoholism Prevalence")
```

Based on the summary statistics and the boxplot of the distribution of differences in alcoholism prevalence between males and females across the world does not appear normally distributed. Normality is an assumption of a paired t-test. We will preform a Shapiro-Wilk test of normality to be certain. 

```{r echo = FALSE}
shapiro.test(difference)
```

Looking at the result of the Shapiro-Wilk normality test we get a p-value of approximately zero, which is less than 0.05. Therefore, we will reject the null hypothesis of normality. We conclude the difference in alcohol prevalence is not normally distributed. Since the normality assumption is violatedwe instead use the non-parametric alternative to the paired t-test, the Wilcoxon signed-rank test, even thought sample size is large (n = 190).

We will test the null hypothesis that the mean rank difference in alcoholism prevalence between men and women is the same against the alternative hypothesis that the mean rank difference in alcoholism prevalence is greater in men. 

```{r echo=FALSE}
wilcox.test(difference, alternative = "greater", conf.int = T)
```

Based on the results of the Wilcoxon signed rank test we get a p-value of approximately zero. This is less that 0.05 therefore we concluded than males have a higher alcoholism prevalence rates. In addition we are 95% confident that the true difference is male and female alcoholism prevalance is 4.75 percentage points.

### Men & Women Correlation 

Even though men have higher alcoholism prevalence rate, there may be a relation between the prevalence rates of men and women in the same country. 

```{r echo = F}
plot(alcoholism$Male, alcoholism$Female, xlab = "male", ylab = "female", main = "Alcoholism Prevalence Rates")
```
Looking at the graph there appears to be a linear relation. So we'll try to fit a linear model. 

```{r echo = F}
cor.test(alcoholism$Male, alcoholism$Female)

```


Looking at the data we are 95% confident that there is between 80.50% and 88.52% correlation between the alcoholism prevalence rates of males and females.   

### Proportion of Alcohol Sales

We will now investigate how much a certain type of alcohol sold impacts alcoholism levels. We will create a regressive model where male and female are factors. We'll start with the effect of wine, to investigate if there is a relation between the proportion of alcohol sales in a country attributed to wine and the prevalence of alcoholism. 

#### Raw Data 

```{r echo = F}
alcohol <- read.csv("purealcohol.csv", header = F, row.names = 1)
colnames(alcohol) <-  as.character(unlist(alcohol[2,]))
alcohol <- alcohol[c(-1, -2),]

# Formatting
alcohol$Spirits <- gsub("No data", "", alcohol$Spirits)
alcohol$Spirits <- as.numeric(alcohol$Spirits)
alcohol$Wine <- gsub("No data", "", alcohol$Wine)
alcohol$Wine <- as.numeric(alcohol$Wine)
alcohol$Beer <- gsub("No data", "", alcohol$Beer)
alcohol$Beer <- as.numeric(alcohol$Beer)

countries <- read.csv("data.csv",header = FALSE)
countries <- countries$V1
countries <- countries[c(-1,-2)]

countries2 <- c(countries, countries)
spirits<- c(alcohol$Spirits, alcohol$Spirits)
wine <- c(alcohol$Wine, alcohol$Wine)
beer <- c(alcohol$Beer, alcohol$Beer)
responses <- c(alcoholism$Male, alcoholism$Female)
factors <- c(rep("M", length(alcoholism$Male)), rep("F", length(alcoholism$Female)))

gender <- data.frame(countries2, responses, wine, spirits, factors)
colnames(gender) <- c("country", "response", "wine", "spirits", "factor")
gender <- gender[,-1]

head(gender)
```

The above is the first few rows of a data table containing the alcoholism prevalence levels of a specific country for a gender and the proportion of the countries alcohol sale that is wine. 


### Type of Alcohol
First, let's look at a scatterplot of the data. 

```{r echo = FALSE}
library(car)
scatterplot(gender$response ~ gender$wine + gender$factor,
            xlab = "Proportion of Alcohol Sold is Wine", 
            ylab = "Prevalence of Alcoholism", 
            main = "Alcoholism Prevalence and Wine Sales",
            legend = list(title = "Gender"))


scatterplot(gender$response ~ gender$spirits + gender$factor,
            xlab = "Proportion of Alcohol Sold is Spirits", 
            ylab = "Prevalence of Alcoholism", 
            main = "Alcoholism Prevalence and Spirits Sales",
            legend = list(title = "Gender"))
```


### Regional

Gender norms vary based on country, so we will include gender and region as variables that interact. 
```{r echo = F}
r <- c('Eastern Mediterranean', 'Europe', 'Africa', 'Americas' , 'Western Pacific', 'South-East Asia' )

#Start at the letter M
regions <- c(r[1], r[2], r[3], r[2], r[3], r[4], r[4], r[2], r[5], r[2], r[2], r[4], r[1], r[6], r[4], r[2], r[2], r[4], r[3], r[6], r[4], r[2], r[3], r[4], r[5], r[2], r[3], r[3], r[3], r[3], r[5], r[3], r[4], r[3], r[3], r[4], r[5], r[4], r[3], r[3], r[5], r[4], r[2], r[4], r[2], r[2], r[6], r[3], r[2], r[1], r[4], r[4], r[4], r[1], r[4], r[3], r[3], r[2], r[3], r[5], r[2], r[2], r[3], r[3], r[2], r[2], r[3], r[2], r[4], r[4], r[3], r[3], r[4], r[4], r[4], r[2], r[2], r[6], r[6], r[1], r[1], r[2], r[2], r[2], r[4], r[5], r[1], r[2], r[3], r[5], r[1], r[2], r[5], r[2], r[1], r[3], r[3], r[1], r[2], r[2], r[3], r[3], r[5], r[6], r[3], r[2], r[5], r[3], r[3], r[4], r[5], r[2], r[5], r[2], r[1], r[3], r[6], r[3], r[5], r[6], r[2], r[5], r[4], r[3], r[3], r[5], r[2], r[1], r[1], r[5], r[4], r[5], r[4], r[4], r[5], r[2], r[2], r[1], r[5], r[2], r[2], r[2], r[3], r[4], r[4], r[4], r[5], r[2], r[3], r[1], r[3], r[2], r[3], r[3], r[5], r[2], r[2], r[5], r[1], r[3], r[2], r[6], r[1], r[4], r[3], r[2], r[2], r[1], r[2], r[6], r[2], r[6], r[3], r[5], r[4], r[1], r[2], r[2], r[5], r[3], r[2], r[1], r[2], r[3], r[4], r[4], r[2], r[5], r[4], r[5], r[1], r[3], r[3])

classified <- cbind.data.frame(alcoholism, regions)
print(classified[,c(-1, -2)])

regions2 <- c(regions, regions)
data.2 <- cbind(gender, regions2)
```

### Income

Remember to edit this data to match that in the alcoholism dataset.
```{r echo = F}

GNI <- read.csv("income.csv", header = F)


income <- c(GNI$V2, GNI$V2)
data.3 <- cbind(data.2, income)

```


--------------------------------------------------------------------------------------------

#### Linear Regression Model 
```{r echo = T}
lm.2 <- lm(response~wine + spirits + income + factor * regions2, data = data.3)

# summary(lm.2)
# plot(lm.2)

data.4 <- data.3[c(-16, -142, -76),]
lm.3 <- lm(response~wine + spirits + income + factor * regions2, data = data.4)
summary(lm.3)
plot(lm.3)
```



We will fit a linear regression model. 



Our fitted model:

$$prevalance = 1.41721 + 0.02853*wine + 5.68066*male$$

#### Plots

We still have to check the conditions of the model to see if it's adequate. 

```{r echo = TRUE}
plot(lm.2)
```

Looking at the Normal Q-Q plot most of the data falls along the dotted line but the end of the ditribution curve at the ends, implying the data is skewed. Looking at the residuals vs. fitted graph a lot of this variation seems to be comming from the larger values, or the men. Otherwise the points look scattered normally and evenly about the line.

#### Residuals



Looking at the residuals of the linear model there over 75 potential influential points that are more extreme than the absolute value of 3. 

Let's try to remove some of the more influential points. 

```{r echo = T}
# sort(wine.lm$residuals)
````

We will remove the top few influential points and re-fit the model. All of these points have "male" as a factor. 

```{r echo = T}
# gender.removed <- gender[c(-76, -142, -16, -157, -58, -156, -127),]
# 
# influential.wine.lm <- lm(response ~ wine + factor, data = gender.removed)
# 
# summary(influential.wine.lm)
# plot(influential.wine.lm)

````

After removing some influential points the percent variation in responses explained by the model increased to 46.62%. However the Normal Q-Q plot and residual vs. fitted values still show there is a lack or normality in the model. Since the normality assumption in the model is not met the model is inadequate. 

# Conclusion

We find that gender is the biggest factor in prevalence rates, and that men are more likely to suffer from alcoholism around the world than women. We also find that there is a positive relationship between the prevalence rate of men and women within a country, and the high prevalence rates of alcoholism in women then it's likely men will also experience a high prevalence rate of alcoholism. 

After we seperated gender out as a factor we analyzed the affect wine had on the model. Even thought our model identified wine as a useful regressor, the regression model it's self was inadequate because it violated the normality assumption deeming all the results useless. 



## try
Health index
income *** 
by region - DONE


level of education
